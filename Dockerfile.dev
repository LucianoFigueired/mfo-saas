FROM node:20-alpine

WORKDIR /app

RUN npm install -g pnpm turbo @nestjs/cli
RUN apk add --no-cache libc6-compat openssl procps

COPY package.json pnpm-lock.yaml pnpm-workspace.yaml turbo.json ./

# 1. Copia os apps
COPY apps/api/package.json ./apps/api/package.json
COPY apps/web/package.json ./apps/web/package.json

# 2. Copia os pacotes de lógica (que já tínhamos)
COPY packages/database/package.json ./packages/database/package.json
COPY packages/common/package.json ./packages/common/package.json

# 3. --- CORREÇÃO: Copia os pacotes de configuração/UI que faltavam ---
# (Verifique se esses caminhos batem com as pastas do seu projeto)
COPY packages/ui/package.json ./packages/ui/package.json
COPY packages/eslint-config/package.json ./packages/eslint-config/package.json
COPY packages/typescript-config/package.json ./packages/typescript-config/package.json

# ... (resto igual)
RUN pnpm install
COPY . .

RUN pnpm --filter @mfo/database exec prisma generate

CMD ["pnpm", "--filter", "@mfo/api", "run", "start:dev"]